<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dweb example - Naming</title>
    <!--COPIED FROM example_naming BUT NOT USED YET
    <link rel='stylesheet' href='example_styles.css'>
    <script type="text/javascript" src="htmlutils.js"></script><!--Non Dweb specific utility functions for working with HTML-->
    <script type="text/javascript" src="loginutils.js"></script><!--Dweb login functions, useful in multiple places-->
    -->
    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><!--briefcase etc-->
    <script type="text/javascript" src="dweb_bundled.js"></script><!-- Load bundle - assigns to "Dweb"-->
    <script type="text/javascript">

        //---------- Could move these to a library -----------

        //-----------------End of candidates for library ----


       async function main() {
            //This is the "main()", starts a transport, checks its status, and if appropriate to app opens a URL passed
            // These next two lines reqd at this level to get the global scope
            try {
                await DwebTransports.p_connect({statuselement: document.getElementById("statuselement"), transports: searchparams.getAll("transport")});
                /* COPIED OVER FROM example_naming.html BUT NOT USED HERE YET
                // Any code you want to run once online goes here.
                var url = searchparams.get("url"); // Unused in this example
                Dweb.KeyChain.eventHandler.addEventListener((event) => {   //TODO-EVENT move to new mechanism in PublicPrivate
                    console.log("event",event);
                    if (event.type === "login") {
                        // noinspection JSIgnoredPromiseFromCall
                        onlogin(event.values); }
                });
                await Dweb.Domain.p_rootSet({verbose});
                console.log("==Login should have finished-== output after here implies async issue ===");
                let el_root_ul = document.getElementById("treeroot_ul");
                addsubdomain(el_root_ul, "/", Dweb.Domain.root);
                END OF COPIED MATERIAL */
            } catch(err) { // Catch any uncaught errors here, log and alert.
                console.log("App Error:", err);
                throw(err);
                alert(err.message);
            }
        }

    </script>
    <style>
        /* COPIED FROM examples_naming BUT NOT USED HERE YET
        .naming_outer { display: inline;}
        .naming_tree {display: inline-grid; background-color: #F0F8F0; vertical-align: top;}
        .naming_tree li { padding: 5px; display: list-item; list-style: none }
        .naming_tree ul { -webkit-padding-start: 15px;}
        .naming_name { background-color: #f0f0f0; padding-left: 5px; }
        .naming_details { background-color:#F0E8F0; display: inline-grid; vertical-align: top;}
        .tree_icon {height: 12px; margin-left: 12px; margin-right: 3px;}
        .naming_details ul { list-style: none; padding-left: 10px;}
        .naming_details li { padding-top: 1px; margin: 0 0 3px 3px;}
        .propname { display: inline-block; background-color: inherit; border: none; vertical-align: top; }
        .propval, .proplist {display: inline-block; background-color: inherit; border: none;}
        .proplist {padding-left: 0px;}
        */
    </style>

</head>
<body class="mirroring">
<div id="statuselement"></div>
<h1>Dweb - Mirroring - Documentation and Planning notes</h1>
<p>This page is an example UI for mirroring connections.</p>
<ul>
<li>For other examples see <a target="_blank" href="./index.html">index.html</a></li>
</ul>
<h1>Dweb - Mirroring - Design and Development</h1>
<h3>Concepts</h3>
<h4>File System</h4>
The files are mirrored in a local file system for several reasons:<ul>
    <li>It allows the local user to act on them as files</li>
    <li>We want to server in both Webtorrent and IPFS and maybe even HTTP</li>
</ul>

<h3>Task list / Code by modules</h3>
<h4>Server Side - ideally nothing required</h4>
<ul>
    <li>Maybe makes sense to add a collection URI</li>
</ul>
<h4>Browser UI</h4>
<ul>
    <li>Served by the downloaded app</li>
    <li>Add/Remove collections & items to list</li>
    <li>Refresh collections</li>
    <li>View logs</li>
    <li>Browse collected content</li>
</ul>
<h4>Helper app/server</h4>
    <ul>
        <li>Downloaded, may require node to be encapsulated somehow</li>
        <li>Start off as GIT clone + node module install</li>
    </ul>
<h4>UI handler</h4>
    <ul>
        <li>Manages collection list</li>
        <li>Manages logs</li>
    </ul>
<h4>File System</h4>
    <ul>
    <li>Mirrors logic of Archive system i.e. base/"data"/itemid/[subdir/]*filename</li>
    <li>Accessed via a class wrapper to allow easier encapsulation of different systems</li>
    <li>API: fetch("archiveid/filename"); store("archiveid/filename")</li>
    </ul>
<h4>Crawler</h4>
    <ul>
        <li>Search on collection</li>
        <li>Parse Search query for items</li>
        <li>Retrieve items via Webtorrent, IPFS, HTTP (urls in items)</li>
    </ul>
<h4>Webtorrent server</h4>
    <ul>
        <li>Uses same peer as Feross installed on IA</li>
        <li>Needs modifying to use FS instead of WT internal storage</li>
    </ul>
<h4>IPFS server</h4>
    <ul>
        <li>What to use depends on which bugs are fixed</li>
        <li>Will need to integrate FS (like urlstore) I believe this may have been done</li>
    </ul>


<script type="text/javascript">
    // These have to be at global level so they can be found anywhere.
    var searchparams = new URL(window.location.href).searchParams;
    var verbose = searchparams.get("verbose") || false;  // Anything specified for verbose is true (could truthify buy no need)
    main();
</script>
</body>
</html>